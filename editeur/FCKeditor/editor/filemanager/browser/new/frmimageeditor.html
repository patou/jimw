<!--
 * FCKeditor - The text editor for internet
 * Copyright (C) 2003-2004 Frederico Caldeira Knabben
 * 
 * Licensed under the terms of the GNU Lesser General Public License:
 * 		http://www.opensource.org/licenses/lgpl-license.php
 * 
 * For further information visit:
 * 		http://www.fckeditor.net/
 * 
 * File Name: frmimageeditor.html
 * 	This page facilitates the editing of images.
 * 
 * Version:  2.0 Beta 2
 * Modified: 2004-11-14 13:00
 * 
 * File Authors:
 * 		Grant French ( grant@mcpuk.net )
 *
 *
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
	<head>
		<meta name="vs_targetSchema" content="http://schemas.microsoft.com/intellisense/ie5">
		<link href="Browser.css" type="text/css" rel="stylesheet">
		<script type="text/javascript" src="js/fckxml.js"></script>
		<script type="text/javascript" src="js/common.js"></script>
		<script type="text/javascript" src="js/wz_jsgraphics.js"></script>
		<script type="text/javascript" src="js/EditorContent.js"></script>
		<script language="javascript" type="text/javascript">
<!--

oConnector.CurrentFolder = GetMyUrlParam( 'CurrentFolder' ) ;
var fileName=GetMyUrlParam( 'FileName' ) ;
var fileURL=unescape( GetMyUrlParam( 'FileURL' ) );
var cursor_X;
var cursor_Y;
var imageEditorLoaded=false;

var bottomFrame1;
var bottomFrame2;
var bottomFrame3;

var t_cx;
var t_cy;
var t_cw;
var t_ch;

var m_sx;
var m_sy;
var m_w;
var m_h;
var m_a;
var m_d;

var s_sw;
var s_sh;

var r_ra;

function RenameFile( fileName, fileUrl )
{
	var promptMsg='Please enter the new name for ' + fileName + ':';
	var newName=prompt(promptMsg,fileName);
	
	if ((newName!=null)&&(newName!='')&&(newName!=fileName)) {
		oConnector.SendCommand( 'RenameFile', "FileName=" + escape( fileName ) + "&NewName=" + escape( newName ), RenameFileCallBack ) ;
	}
}

function RenameFolder( folderName )
{
	var promptMsg='Please enter the new name for ' + folderName + ':';
	var newName=prompt(promptMsg,folderName);
	
	if ((newName!=null)&&(newName!='')&&(newName!=folderName)) {
		oConnector.SendCommand( 'RenameFolder', "FolderName=" + escape( folderName ) + "&NewName=" + escape ( newName ), RenameFolderCallBack ) ;
	}
}

function LoadResources( resourceType, folderPath )
{
	oListManager.Clear() ;
	oConnector.ResourceType = resourceType ;
	oConnector.CurrentFolder = folderPath
	oConnector.SendCommand( 'GetFoldersAndFiles', null, GetFoldersAndFilesCallBack ) ;
}

function Refresh()
{
	LoadResources( oConnector.ResourceType, oConnector.CurrentFolder ) ;
}

function RenameFolderCallBack ( fckXml )
{
	var oNodes = fckXml.SelectNodes( 'Connector/Error' );
	if (oNodes.length>0) {
		var errNo = parseInt(oNodes[0].attributes.getNamedItem('number').value) ;
		
		switch (errNo) {
			case 0 :
				break;	
			
			case 602 :
				alert('Failed to rename folder.');
				break;
			
			default:
				alert('Invalid XML response from connector..');
		}
	} else {
		alert('Invalid XML response from connector.');
	}
	Refresh();
}

function drawFramework() 
{
	bottomFrame1 = top.frames['frmCreateFolder'].document;
	bottomFrame2 = top.frames['frmUpload'].document;
	bottomFrame3 = top.frames['frmFolders'].document;
	
	bottomFrame1.body.innerHTML='<table style="border-width: 0px; border-style: none;" align="center" cellpadding="2" id="toolbar1"><table>';
	bottomFrame2.body.innerHTML='<table style="height: 100%; border-width: 0px; border-style: none;" cellpadding="4"><tr id="toolbar2"></tr><table>';
	bottomFrame3.body.innerHTML='<table style="border-width: 0px; border-style: none;" align="center" cellpadding="8" id="toolbar3"><table>';
	
	var toolbar1 = bottomFrame1.getElementById('toolbar1');
	var toolbar2 = bottomFrame2.getElementById('toolbar2');
	var toolbar3 = bottomFrame3.getElementById('toolbar3');
	

/*#######################*/
/* START OF MAIN TOOLBAR */
/*#######################*/

	/* --- Save Image --- */
	var row = toolbar3.insertRow(-1);
	var oCell = row.insertCell(-1);
	oCell.innerHTML = 	'<a href="" title="Save Image">' +
				'<img src="images/toolbar/save.gif" style="width: 22px; height: 22px;" /><br />' + 
				'Save' +
				'</a>';
	oCell.noWrap = true;
	oCell.align = 'center';
		
	
	/* --- Close Image --- */
	var row = toolbar3.insertRow(-1);
	var oCell = row.insertCell(-1);
	oCell.innerHTML = 	'<a href="#" title="Close Image" onclick="window.top.location.reload();">' +
				'<img src="images/toolbar/close.gif" style="width: 22px; height: 22px;" /><br />' + 
				'Close' +
				'</a>';
	oCell.noWrap = true;
	oCell.align = 'center';
	
	
	/* --- Seperator --- */
	var row = toolbar3.insertRow(-1);
	var oCell = row.insertCell(-1);
	oCell.innerHTML = 	'<hr /><br />';
				
	oCell.noWrap = true;
	oCell.align = 'center';
	
	
	/* --- Crop Image --- */
	var row = toolbar3.insertRow(-1);
	var oCell = row.insertCell(-1);
	oCell.innerHTML = 	'<a href="javascript: top.frames[\'frmResourcesList\'].setMode(\'crop\');" title="Crop Image">' +
				'<img src="images/toolbar/crop.gif" style="width: 22px; height: 22px;" /><br />' + 
				'Crop' +
				'</a>';
	oCell.noWrap = true;
	oCell.align = 'center';
	
	
	/* --- Resize Image --- */
	var row = toolbar3.insertRow(-1);
	var oCell = row.insertCell(-1);
	oCell.innerHTML = 	'<a href="javascript: top.frames[\'frmResourcesList\'].setMode(\'scale\');" title="Resize Image">' +
				'<img src="images/toolbar/resize.gif" style="width: 22px; height: 22px;" /><br />' + 
				'Resize' +
				'</a>';
	oCell.noWrap = true;
	oCell.align = 'center';
	
	
	/* --- Rotate Image --- */
	var row = toolbar3.insertRow(-1);
	var oCell = row.insertCell(-1);
	oCell.innerHTML = 	'<a href="javascript: top.frames[\'frmResourcesList\'].setMode(\'crop\');" title="Rotate Image">' +
				'<img src="images/toolbar/rotate.gif" style="width: 22px; height: 22px;" /><br />' + 
				'Rotate' +
				'</a>';
	oCell.noWrap = true;
	oCell.align = 'center';
	
	
	/* --- Flip Image --- */
	var row = toolbar3.insertRow(-1);
	var oCell = row.insertCell(-1);
	oCell.innerHTML = 	'<a href="javascript: top.frames[\'frmResourcesList\'].setMode(\'crop\');" title="Flip Image">' +
				'<img src="images/toolbar/flip.gif" style="width: 22px; height: 22px;" /><br />' + 
				'Flip' +
				'</a>';
	oCell.noWrap = true;
	oCell.align = 'center';
	
	

/*###################*/
/* START OF INFO BAR */
/*###################*/
	/* --- X Position --- */
	var row = toolbar1.insertRow(-1);
	var oCell = row.insertCell(-1);
	oCell.innerHTML = '<div style="display: inline;">X: <div style="display: inline;" id="cursor_x">0</div>px</div>';
	oCell.noWrap = true;
	oCell.align = 'center';
	cursor_X=bottomFrame1.getElementById('cursor_x');
	
	/* --- Y Posision --- */
	var row = toolbar1.insertRow(-1);
	var oCell = row.insertCell(-1);
	oCell.innerHTML = '<div style="display: inline;">Y: <div style="display: inline;" id="cursor_y">0</div>px</div>';
	oCell.noWrap = true;
	oCell.align = 'center';
	cursor_Y=bottomFrame1.getElementById('cursor_y');

	
/*#####################*/
/* START OF MANUAL BAR */
/*#####################*/

	/* --- X Position --- */
	//var row = toolbar2.insertRow(-1);
	var oCell = toolbar2.insertCell(-1);
	oCell.innerHTML = '<input type="text" id="cx" />' + 
	'<input type="text" id="cy" />' + 
	'<input type="text" id="cw" />' + 
	'<input type="text" id="ch" />' + 
	'<input type="text" id="sx" />' + 
	'<input type="text" id="sy" />' + 
	'<input type="text" id="mw" />' + 
	'<input type="text" id="mh" />' + 
	'<input type="text" id="ma" />' + 
	'<input type="text" id="md" />' + 
	'<input type="text" id="sw" />' + 
	'<input type="text" id="sh" />' + 
	'<input type="text" id="ra" /><input type="checkbox" id="constrained" />';
	
	oCell.noWrap = true;
	oCell.align = 'center';
	cursor_X=bottomFrame1.getElementById('cursor_x');


}

window.onload = function()
{
	drawFramework();
	document.getElementById('theImage').src=fileURL;
	
	
	t_cx = bottomFrame2.getElementById('cx');
	t_cy = bottomFrame2.getElementById('cy');
	t_cw = bottomFrame2.getElementById('cw');
	t_ch = bottomFrame2.getElementById('ch');
	
	m_sx = bottomFrame2.getElementById('sx');
	m_sy = bottomFrame2.getElementById('sy');
	m_w = bottomFrame2.getElementById('mw');
	m_h = bottomFrame2.getElementById('mh');
	m_a = bottomFrame2.getElementById('ma');
	m_d = bottomFrame2.getElementById('md');
	
	s_sw = bottomFrame2.getElementById('sw');
	s_sh = bottomFrame2.getElementById('sh');
	
	r_ra = bottomFrame2.getElementById('ra');
	
	jg_doc = new jsGraphics("imgCanvas"); // draw directly into document
	jg_doc.setColor("#000000"); // black
	
	setMode('crop');
	
	imageEditorLoaded=true;
}

function updateXY(eventObject)
{
	if (imageEditorLoaded) {
		cursor_X.innerHTML = eventObject.pageX;
		cursor_Y.innerHTML = eventObject.pageY;
	}
}

//-->

		</script>
		<style type="text/css">
			body { margin: 0; padding: 0;  background-color: #eee; }
			table { width: 100%; }
			table td { text-align: center; }
			.crop{cursor:crosshair;}
			.selection { border: dotted 1px #000000; position:absolute; width: 0px; height: 1px; z-index:5; }
			.selectionWhite{ border: dotted 1px #FFFFFF; position:absolute; width: 0px; height: 1px; z-index:5; }
			.handleBox{ z-index:105; }
			.error { font-size:large; font-weight:bold; color:#c00; font-family: Helvetica, sans-serif; } 
		</style>
	</head>
	<body class="FileArea" bottomMargin="10" leftMargin="10" topMargin="10" rightMargin="10">
		<div id="status"></div>
		<div id="ant" class="selection" style="visibility:hidden"><img src="img/spacer.gif" width="0" height="0" border="0" alt="" id="cropContent"></div>
		<!--<table height="100%" width="100%">
			<tr>
				<td>-->
					<span id="imgCanvas" class="crop"><img src="" width="100" height="100" alt="" id="theImage" name="theImage"></span>
			<!--	</td>
			</tr>
		</table>-->
	</body>
</html>
