<?php
function encode($text) {
	return (JIMW_UTF8) ? $text : utf8_encode($text);
}
$entries = array();
$tree = new Jimw_Site_Tree();
foreach ($this->messages as $message) {
	$result = $tree->find($message->tree_parentid)->current();
	$entries[] = array('title' => encode($message->title),
						'link' => $this->url(array('alias' => $result->alias, 'format' => 'phtml'), 'alias') . '#' . $message->id,
						'description' => $this->escape(encode($this->troncate($message->content))),
						'content:encoded' => $this->escape(encode($message->content))
						);
}
$builder = array('title' => encode($this->tree->pagetitle),
			'charset' => 'UTF-8',
			 'link' => $this->url(array('alias' => $this->tree->alias, 'ext' => 'rss'), 'alias'),
			 'entries' => $entries);
			 Jimw_Debug::dump($builder);

$rss = Zend_Feed::importArray($builder, 'rss');
$response = Zend_Controller_Front::getInstance()->getResponse();
$response->setHeader('Content-type', 'application/rss+xml; charset: UTF-8');
echo $rss->saveXML();